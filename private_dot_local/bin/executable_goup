#!/usr/bin/env bash

set -euCo pipefail
shopt -s expand_aliases

. ~/.local/libs/main.sh

script_dir="$(dirname "$(readlink -f "$0")")"
script_name=$(basename "$0")

args::program "$script_name" "1.0" "Invoke a command in the current directory and parent directories"

args::option "-v, --version" "Show version"
args::option "-h, --help" "Show help"

args::parse "$@"
eval set -- "${args_cleaned}"

current_dir="$PWD"
trap 'cd "$current_dir"' EXIT

last_dir="/"

while true; do
  eval "$@"
  dir="$PWD"
  [[ "$dir" == "$last_dir" ]] && break
  [[ "$dir" == "/" ]] && break
  cd ..
done
